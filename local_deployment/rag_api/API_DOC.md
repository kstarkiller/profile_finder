# Technical Documentation for the API

## API Architecture

This API is built with FastAPI and uses the REST style. It is designed to handle files, create and manage profiles, and process questions with answers generated by a language model. The API is integrated with a logging system for tracking events and errors. Here is an overview of the key components:

- FastAPI for creating RESTful APIs.
- MLflow for tracking machine learning experiments.
- MongoDB for data storage.
- Docker for encapsulating application dependencies.
- Pydantic for data validation.

### Endpoints

The API offers several endpoints that can be divided into the following categories:

1. Base Endpoints

   - GET / : Checks if the API is running.
   - POST /test : Test endpoint.

2. Authentication

   - GET /token : Retrieves an access token for the user.

3. File Management

   - POST /file : Stores a file in the database.
   - GET /file : Retrieves a file from the database.

4. Profile Management

   - GET /profiles : Inserts profiles into the database if they do not exist.
   - DELETE /profiles : Clears the profiles table in the database.

5. Embedding and Processing
   - POST /embed : Performs embeddings on documents.
   - POST /chat : Processes a question and returns an answer.
   - POST /chat/id : Generates a new chat ID.

## Authentication and Access Authorization

### Authentication

The API uses JWT (JSON Web Tokens) to secure the endpoints.

- Obtaining a Token:
  - Endpoint: GET /token
  - Parameters: username (string) - The user's name.

When the user makes a request to this endpoint, a JWT token is generated if the credentials are correct.

### Authorization

All endpoints (except "/" and "/token") are protected by the Depends mechanism. This means they take a current_user derived from the authentication function, requiring a valid token.

## OpenAPI Standards

### OpenAPI Specification

This API complies with OpenAPI standards in terms of schema definition and operations. Here are some example specifications for certain endpoints.

```yaml
openapi: 3.0.0
info:
  title: Profile Finder API
  version: 1.0.0
paths:
  /:
    get:
      summary: Root endpoint
      description: This is the root endpoint of the API.
      responses:
        200:
          description: API is running

  /token:
    get:
      summary: Get token
      parameters:
        - name: username
          in: query
          required: true
          schema:
            type: string
      responses:
        200:
          description: Token retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  token_type:
                    type: string

    /file:
        post:
            summary: Store a file
            requestBody:
                required: true
                content:
                    multipart/form-data:
                        schema:
                            type: object
                            properties:
                    file:
                        type: string
                        format: binary
            responses:
                200:
                    description: File stored successfully
        get:
            summary: Retrieve a file
            parameters:
                - name: file_id
                    in: query
                    required: true
                    schema:
                        type: string
            responses:
                200:
                    description: File retrieved successfully
                    content:
                        application/octet-stream:
                            schema:
                                type: string
                                format: binary

    /chat:
        post:
            summary: Process a question and return an answer
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                        properties:
                            question:
                                type: string
            responses:
                200:
                    description: Answer generated successfully
                    content:
                        application/json:
                            schema:
                                type: object
                            properties:
                                answer:
                                    type: string

    /chat/id:
        post:
            summary: Generate a new chat ID
            responses:
                200:
                    description: New chat ID generated successfully
```
